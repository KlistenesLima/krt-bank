<div class="command-center" [class.collapsed]="sidebarCollapsed">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo" *ngIf="!sidebarCollapsed">
        <span class="logo-icon">&#9670;</span>
        <span class="logo-text">KRT</span>
        <span class="logo-sub">COMMAND</span>
      </div>
      <button class="collapse-btn" (click)="sidebarCollapsed = !sidebarCollapsed">
        {{ sidebarCollapsed ? '&#9654;' : '&#9664;' }}
      </button>
    </div>

    <nav class="sidebar-nav">
      <button [class.active]="activeSection === 'dashboard'" (click)="setSection('dashboard')">
        <span class="nav-icon">&#128202;</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Dashboard</span>
      </button>
      <button [class.active]="activeSection === 'transactions'" (click)="setSection('transactions')">
        <span class="nav-icon">&#128184;</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Transacoes</span>
      </button>
      <button [class.active]="activeSection === 'accounts'" (click)="setSection('accounts')">
        <span class="nav-icon">&#128101;</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Contas</span>
      </button>
      <button [class.active]="activeSection === 'fraud'" (click)="setSection('fraud')">
        <span class="nav-icon">&#128737;&#65039;</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Fraude</span>
        <span class="nav-badge" *ngIf="!sidebarCollapsed && fraudAlerts.length">{{ fraudAlerts.length }}</span>
      </button>
      <button [class.active]="activeSection === 'system'" (click)="setSection('system')">
        <span class="nav-icon">&#9881;&#65039;</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">Sistema</span>
      </button>
    </nav>

    <div class="sidebar-footer" *ngIf="!sidebarCollapsed">
      <button class="back-btn" (click)="logout()">&#8592; Voltar ao App</button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topbar-left">
        <h1>{{ activeSection === 'dashboard' ? 'Command Center' : activeSection === 'transactions' ? 'Monitor de Transacoes' : activeSection === 'accounts' ? 'Gestao de Contas' : activeSection === 'fraud' ? 'Central de Fraude' : 'Status do Sistema' }}</h1>
      </div>
      <div class="topbar-right">
        <span class="live-indicator">
          <span class="pulse-dot"></span> LIVE
        </span>
        <span class="clock">{{ currentTime }}</span>
        <div class="admin-avatar">AD</div>
      </div>
    </header>

    <!-- LOADING -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
      <span>Carregando dados...</span>
    </div>

    <!-- ========== DASHBOARD ========== -->
    <div class="content-area" *ngIf="!loading && activeSection === 'dashboard' && dashboard">
      <!-- KPI CARDS -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-header">
            <span class="kpi-label">Contas Ativas</span>
            <span class="kpi-trend up">&#8593; 12%</span>
          </div>
          <div class="kpi-value">{{ dashboard.overview.activeAccounts | number }}</div>
          <div class="kpi-sub">de {{ dashboard.overview.totalAccounts | number }} totais</div>
        </div>
        <div class="kpi-card accent-blue">
          <div class="kpi-header">
            <span class="kpi-label">Transacoes Hoje</span>
            <span class="kpi-trend up">&#8593; 8%</span>
          </div>
          <div class="kpi-value">{{ dashboard.transactions.today | number }}</div>
          <div class="kpi-sub">Ticket medio: R$ {{ dashboard.transactions.avgTicket | number:'1.0-0' }}</div>
        </div>
        <div class="kpi-card accent-green">
          <div class="kpi-header">
            <span class="kpi-label">Volume Total</span>
            <span class="kpi-trend up">&#8593; 15%</span>
          </div>
          <div class="kpi-value">R$ {{ getTotalVolume() }}</div>
          <div class="kpi-sub">{{ dashboard.transactions.thisMonth | number }} este mes</div>
        </div>
        <div class="kpi-card accent-red">
          <div class="kpi-header">
            <span class="kpi-label">Alertas Fraude</span>
            <span class="kpi-trend down">{{ dashboard.fraud.alertsToday }}</span>
          </div>
          <div class="kpi-value">{{ dashboard.fraud.blockedToday }} bloq.</div>
          <div class="kpi-sub">R$ {{ dashboard.fraud.totalFraudPrevented | number:'1.0-0' }} evitados</div>
        </div>
      </div>

      <!-- CHARTS ROW: Line + Donut -->
      <div class="charts-row">
        <div class="chart-card chart-large">
          <div class="chart-header">
            <h3>Volume de Transacoes</h3>
            <span class="chart-period">Ultimos 14 dias</span>
          </div>
          <div class="chart-canvas-wrapper">
            <canvas id="chartTransactions"></canvas>
          </div>
        </div>
        <div class="chart-card chart-small">
          <div class="chart-header">
            <h3>Receita por Produto</h3>
          </div>
          <div class="chart-canvas-wrapper donut-wrapper">
            <canvas id="chartRevenue"></canvas>
          </div>
        </div>
      </div>

      <!-- ACTIVITY FEED -->
      <div class="charts-row">
        <div class="chart-card full-width feed-card">
          <div class="chart-header">
            <h3>Atividade em Tempo Real</h3>
            <span class="chart-period live-text">&#9679; Live</span>
          </div>
          <div class="activity-feed">
            <div class="feed-item" *ngFor="let item of activityFeed">
              <span class="feed-dot" [style.background]="item.color"></span>
              <span class="feed-text">{{ item.text }}</span>
              <span class="feed-time">{{ item.time }}</span>
            </div>
            <div class="feed-empty" *ngIf="activityFeed.length === 0">
              Aguardando atividade...
            </div>
          </div>
        </div>
      </div>

      <!-- SYSTEM HEALTH ROW -->
      <div class="charts-row">
        <div class="chart-card full-width">
          <div class="chart-header"><h3>Saude do Sistema</h3></div>
          <div class="health-grid">
            <div class="health-item">
              <span class="health-dot green"></span>
              <span class="health-label">API Gateway</span>
              <span class="health-val">{{ dashboard.systemHealth.apiLatency }}</span>
            </div>
            <div class="health-item">
              <span class="health-dot green"></span>
              <span class="health-label">Uptime</span>
              <span class="health-val">{{ dashboard.systemHealth.uptime }}</span>
            </div>
            <div class="health-item">
              <span class="health-dot" [class.green]="dashboard.systemHealth.errorRate &lt; '1%'" [class.yellow]="dashboard.systemHealth.errorRate >= '1%'"></span>
              <span class="health-label">Taxa de Erro</span>
              <span class="health-val">{{ dashboard.systemHealth.errorRate }}</span>
            </div>
            <div class="health-item">
              <span class="health-dot blue"></span>
              <span class="health-label">Sessoes Ativas</span>
              <span class="health-val">{{ dashboard.systemHealth.activeSessions }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== ACCOUNTS ========== -->
    <div class="content-area" *ngIf="!loading && activeSection === 'accounts'">
      <div class="section-stats">
        <span class="stat-chip">{{ pendingAccounts.length }} pendentes</span>
      </div>
      <div class="data-table">
        <div class="table-header">
          <span class="col-name">Nome</span>
          <span class="col-email">Email</span>
          <span class="col-status">KYC Status</span>
          <span class="col-risk">Risco</span>
          <span class="col-actions">Acoes</span>
        </div>
        <div class="table-row" *ngFor="let a of pendingAccounts">
          <span class="col-name">
            <div class="user-avatar">{{ a.name.charAt(0) }}</div>
            <div>
              <strong>{{ a.name }}</strong>
              <small>{{ a.cpf }}</small>
            </div>
          </span>
          <span class="col-email">{{ a.email }}</span>
          <span class="col-status">
            <span class="status-chip kyc">{{ a.kycStatus }}</span>
          </span>
          <span class="col-risk">
            <div class="risk-bar">
              <div class="risk-fill" [style.width.%]="a.riskScore"
                   [class.low]="a.riskScore < 30" [class.med]="a.riskScore >= 30 && a.riskScore < 70" [class.high]="a.riskScore >= 70"></div>
            </div>
            <small>{{ a.riskScore }}%</small>
          </span>
          <span class="col-actions">
            <button class="action-btn approve" (click)="reviewAccount(a.id, true)">Aprovar</button>
            <button class="action-btn reject" (click)="reviewAccount(a.id, false)">Rejeitar</button>
          </span>
        </div>
      </div>
    </div>

    <!-- ========== FRAUD ========== -->
    <div class="content-area" *ngIf="!loading && activeSection === 'fraud'">
      <div class="section-stats">
        <span class="stat-chip red">{{ pendingFraudCount }} pendentes</span>
        <span class="stat-chip orange">{{ highSeverityCount }} alta severidade</span>
      </div>
      <div class="fraud-list">
        <div class="fraud-card" *ngFor="let a of fraudAlerts" [ngClass]="getSeverityClass(a.severity)">
          <div class="fraud-card-header">
            <div class="fraud-card-left">
              <span class="sev-badge" [ngClass]="'badge-' + a.severity">{{ getSeverityLabel(a.severity) }}</span>
              <strong>{{ a.type }}</strong>
            </div>
            <div class="fraud-card-right">
              <span class="fraud-status" [ngClass]="'fstatus-' + a.status.toLowerCase()">{{ a.status }}</span>
            </div>
          </div>
          <div class="fraud-card-body">
            <p>{{ a.description }}</p>
            <div class="fraud-meta-row">
              <span>&#128100; {{ a.accountName }}</span>
              <span *ngIf="a.amount > 0">&#128176; R$ {{ a.amount | number:'1.2-2' }}</span>
              <span>&#128336; {{ a.createdAt | date:'HH:mm' }}</span>
            </div>
          </div>
          <div class="fraud-card-actions" *ngIf="a.status === 'Pendente'">
            <button class="action-btn reject" (click)="fraudAction(a.id, 'block')">&#128683; Bloquear</button>
            <button class="action-btn approve" (click)="fraudAction(a.id, 'approve')">&#9989; Liberar</button>
            <button class="action-btn investigate" (click)="fraudAction(a.id, 'investigate')">&#128269; Investigar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== TRANSACTIONS ========== -->
    <div class="content-area" *ngIf="!loading && activeSection === 'transactions'">
      <div class="charts-row">
        <div class="chart-card full-width">
          <div class="chart-header">
            <h3>Volume Diario (R$)</h3>
            <span class="chart-period">Ultimos 14 dias</span>
          </div>
          <div class="chart-canvas-wrapper chart-tall">
            <canvas id="chartVolume"></canvas>
          </div>
        </div>
      </div>
      <div class="section-stats">
        <span class="stat-chip blue">{{ dashboard?.transactions?.today | number }} hoje</span>
        <span class="stat-chip">{{ dashboard?.transactions?.thisWeek | number }} esta semana</span>
        <span class="stat-chip green">{{ dashboard?.transactions?.thisMonth | number }} este mes</span>
      </div>
    </div>

    <!-- ========== SYSTEM ========== -->
    <div class="content-area" *ngIf="!loading && activeSection === 'system' && dashboard">
      <div class="services-grid">
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>API Gateway</h4>
          <span class="service-detail">Porta 5000 &#183; {{ dashboard.systemHealth.apiLatency }}</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Payments API</h4>
          <span class="service-detail">Porta 5002 &#183; .NET 8</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Onboarding API</h4>
          <span class="service-detail">Porta 5001 &#183; .NET 8</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>PostgreSQL</h4>
          <span class="service-detail">Porta 5432 &#183; v16</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Apache Kafka</h4>
          <span class="service-detail">Porta 9092 &#183; Mensageria</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>RabbitMQ</h4>
          <span class="service-detail">Porta 5672 &#183; AMQP</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Redis</h4>
          <span class="service-detail">Porta 6379 &#183; Cache</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Seq (Logs)</h4>
          <span class="service-detail">Porta 8081 &#183; Observabilidade</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Fraud Worker</h4>
          <span class="service-detail">Background &#183; Saga Pattern</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>PIX Keys API</h4>
          <span class="service-detail">Porta 5003 &#183; Registry</span>
        </div>
        <div class="service-card online">
          <div class="service-status"><span class="status-dot"></span> Online</div>
          <h4>Angular Web</h4>
          <span class="service-detail">Porta 4200 &#183; Frontend</span>
        </div>
      </div>
      <div class="system-summary">
        <div class="summary-item"><span>Uptime</span><strong>{{ dashboard.systemHealth.uptime }}</strong></div>
        <div class="summary-item"><span>Taxa de Erro</span><strong>{{ dashboard.systemHealth.errorRate }}</strong></div>
        <div class="summary-item"><span>Sessoes Ativas</span><strong>{{ dashboard.systemHealth.activeSessions }}</strong></div>
        <div class="summary-item"><span>Containers</span><strong>11</strong></div>
      </div>
    </div>
  </main>
</div>
